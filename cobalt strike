three parts to cobalt strike:
      beacon: post-exploitation agent, responsible for communicating back to server. implemented as a DLL but can be packaged into payloads of various formats
      team server: central control and logging system which stores information collected during an engagement
      client: used by the red team to connect to one or more team servers to manage and interact with beacon payloads

listeners define the protocol and parameters by which a beacon payload communicates w/ a team server
      provided by default: HTTP/S, DNS, SMB, TCP
      split into two types:
            egress: egress beacon communicates directly to a team server (DNS and HTTP/S)
            peer-to-peer (P2P): has its traffic routed through another beacon (SMB and TCP) and ultimately will be linked to an egress beacon to reach the team server

HTTP/S listeners:
      the team server starts a built-in web server to serve the requests
      GETs to fetch tasks from the team server
      POSTs to send back the results

HTTP/S hosts:
      IP or domain name that the beacon will send its HTTP/S requests to
      this IP or domain may resolve directly to a team server or a redirector (iptables, socat, nginx, etc.)
      host rotation strategies:
            round robin: loops through host list top-to-bottom
            random: randomly selected host
            failover: failover-x or failover-m/h/d
            rotate: rotate-m/h/d where each host is used for the given time period and then rotated to next in list
      max retry strategies:
            none: will run indefinitely 
            exit: exit-[max_attempts]-[increase_attempts]-[duration]
                  e.g. exit-50-25-1h tells the beacon to increase sleep time to 1h after 25 failed attempts and exit at 50 failed attempts
      guardrails:
            prevent stageless beacon payloads from running unless specific criteria is met (such as hostname, username, IP, etc.)

DNS listener:
      the team server starts a built-in web DNS server to serve the requests
      communicates via DNS requests, such as A, AAAA, TXT record lookups
      NOTE: must add the nedded DNS records to make the team server authoritative for one or more subdomains
      the beacon checks in with the server with an A record lookup
      the 'checkin' command transmits the beacon's metadata

SMB listener:
      this listener does not bind or listen on the team server
      the SMB beacon payload will create an SMB pipe using the pipename specified
      another beacon will then be used to connect to the named pipe and relay traffic

TCP listener:
      this listener does not bind or listen on the team server
      the TCP beacon payload will bind and listen on the port specified
      another beacon will then be used to connect to the port and relay traffic

beacon payloads...
      most C2 agents are written as a DLL and paired with a loader to load from memory
      stomped loader:
            implemeted with a reflective loader function, which when called, walks back over its own image, maps a new copy of itself into memory, and calls its entry point. it lives in the .text section
            because the DLL is exported as shellcode, a small shellcode stub must be written over the PE's DOS header which is responsible for jumping code execution to the ReflectiveLoader
      prepended loader:
            the loader is prepended to the front of a PE
      staged payloads: 
            allow for separation of exploit (code that triggers the vulnerability) and payload (code we want ran as a result)
            a small program (the stager) will execute and reach out over a different channel to retrieve the full payload (the stage) 
            NOTE: stagers are typically ~900 bytes whereas a stage is ~308000 bytes
            the stager may be susceptible to hijacking due to its small size, it does not verify who it is communicating with
            also due to the small size, several good coding practices are omitted 

generating payloads via cobalt strike...
      HTML application (.hta):
            methods of execution: exeutable, powershell, VBA
            always delivers an x86 payload
      office macro:
            method of execution: VBA macri
            always delivers an x86 payload
      stager/stageless:
            provide source code files for a variety of languages, similar to msfvenom 
      windows stager/stageless:
            methods of execution: exe, windows service exe, windows DLL

interacting with beacons via cobalt strike...
      when a beacon first checks in to a team server, a record will appear in the event log and a new session will appear in the table
      table columns:
            external: external IP of the target
            internal: internal IP of the target
            listener: name of egress listener the beacon is communicating through
            last: the last the beacon communicated with the team server
            sleep: the sleep time of the beacon
      a blue monitor icon depicts standard user privilges, where red depicts local admin or SYSTEM
      to interact with a session, double-click or right-click and select 'interact'
      the graph view better depicts the relationship b/w several beacons:
            dashed green line: HTTP/S
            dashed yellow line: DNS
            solid yellow line: SMB
            solid green line: TCP
